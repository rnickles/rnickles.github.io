---
layout: default
title: Game
---

<script src="game/matter.min.js"></script>

<script type="module">

import { init_level1 } from './game/levels/level1.js'
import { init_level2 } from './game/levels/level2.js'

// create an engine
var engine = Matter.Engine.create();

let MAX_LEVEL = 2;
var current_level = 1;
var game_state = {level_complete: false};

// create a renderer
var render = Matter.Render.create({
    element: document.body,
    engine: engine,
    options: {wireframes: false}
});

let bodies_to_check = init_level1(Matter, engine, game_state);

// run the renderer
Matter.Render.run(render);

function update() {
    for (let j = 0; j < bodies_to_check.length; j++) {
      bodies_to_check[j].update()
    }

    if (game_state.level_complete == true) {
        game_state.level_complete = false;
        current_level += 1;
        if (current_level > MAX_LEVEL) {
            console.log("woot! game over!"); 
            return;
        }
        // Clear all bodies from the world
        Matter.World.clear(engine.world, false);
        // Clear the engine
        Matter.Engine.clear(engine);
        // Stop the renderer
        Matter.Render.stop(render);
        // Remove the old canvas
        render.canvas.parentNode.removeChild(render.canvas);
        // Create a new renderer
        render = Matter.Render.create({
            element: document.body,
            engine: engine,
            options: {wireframes: false}
        });

        if (current_level == 2) {
            console.log("level 1 passed; level 2 loading");
            bodies_to_check = init_level2(Matter, engine, game_state)
        }

        // Restart the renderer
        Matter.Render.run(render);
    }

    Matter.Engine.update(engine, 1000 / 60 );
    requestAnimationFrame(update);
}

// run the engine
requestAnimationFrame(update);

</script>
